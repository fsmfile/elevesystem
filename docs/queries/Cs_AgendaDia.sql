SELECT IIf(IsNull([Cod_OrdemServico] & [tbl_rot_tarefas]![ID]),[dtagenda] & " " & [HrInicial_Agenda] & " | LIVRE",IIf(IsNull([Cod_OrdemServico]),[dtagenda] & " " & [HrInicial_Agenda] & " | Cod Tarefa: " & [tbl_rot_tarefas]![ID],[dtagenda] & " " & [HrInicial_Agenda] & " | Cod O.S: " & [Cod_OrdemServico])) AS InputText, Day([DtAgenda]) AS Dia, tbl_Agenda.HrInicial_Agenda, tbl_Agenda.HrFinal_Agenda, tbl_cad_funcionarios.Nome_funcionario, IIf(IsNull([Cod_OrdemServico] & [tbl_rot_tarefas]![ID]),1,0) AS ValidaAgenda, tbl_Agenda.ID, tbl_Agendamento.CancelarAgendamento
FROM tbl_rot_tarefas RIGHT JOIN (tbl_rot_OrdemServico RIGHT JOIN (tbl_cad_funcionarios RIGHT JOIN (tbl_Agenda LEFT JOIN tbl_Agendamento ON tbl_Agenda.ID = tbl_Agendamento.CodAgenda_agendamento) ON tbl_cad_funcionarios.mat_funcionario = tbl_Agenda.Funcionario_Agenda) ON tbl_rot_OrdemServico.Cod_OrdemServico = tbl_Agendamento.Cod_OrdemServico_Agendamento) ON tbl_rot_tarefas.ID = tbl_Agendamento.Cod_Tarefas_Agendamento
WHERE (((tbl_Agendamento.CancelarAgendamento) Is Null Or (tbl_Agendamento.CancelarAgendamento)=0) AND ((tbl_cad_funcionarios.mat_funcionario)=[Formulários]![frmAgenda]![CxFuncionario]) AND ((Month([DtAgenda]))=[Formulários]![frmAgenda]![month]) AND ((tbl_Agenda.Cancelar_Agenda)=False) AND ((Year([DtAgenda]))=[Formulários]![frmAgenda]![year]))
ORDER BY Day([DtAgenda]), tbl_Agenda.HrInicial_Agenda;
